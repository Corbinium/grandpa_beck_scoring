<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skull King Score Card</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;

            --u: 2px;
            --main: #333333;
            --main-accent: #dbb300;
            --main-highlight: #e8c520;
            --primary: #ebd5b3;
            --primary-accent: #000000;
            --secondary: #dbb172;
            --secondary-accent: #000000;
            --tertiary: #666666;
            --tertiary-accent: #FFFFFF;
            --quaternary: #999999;
            --quaternary-accent: #FFFFFF;
        }

        body {
            font-family: Arial, sans-serif;
            background: var(--main);
            overflow: hidden;
        }

        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .scrollable_wrapper {
            flex: 1;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }

        .content_wrapper {
            display: inline-flex;
            flex-direction: column;
            min-width: min-content;
        }



        .game_sheet {
            display: flex;
            gap: 20px;
            flex: 1;
        }
        

        
        .header {
            display: flex;
            gap: 20px;
            position: sticky;
            top: 0;
            background: var(--main);
            text-align: center;
            z-index: 100;
            padding-left: calc(var(--u) * 45);
            padding-top: 60px
        }

        .footer {
            display: flex;
            gap: 20px;
            position: sticky;
            bottom: 0;
            background: var(--main);
            text-align: center;
            z-index: 100;
            padding-left: calc(var(--u) * 45);
            padding-bottom: 60px;
        }


        .round_column {
            container-type: inline-size;
            display: flex;
            flex-direction: column;
            width: calc(var(--u)*35);
            flex-shrink: 0;
            position: sticky;
            left: 0;
            background: var(--main);
            color: white;
            font-weight: bold;
            font-size: calc(var(--u) * 10);
            text-align: right;
            gap: calc(var(--u) * 64);
            padding-top: calc(var(--u) * 20);
            padding-right: calc(var(--u) * 5);
        }

        .player_column {
            container-type: inline-size;
            display: flex;
            flex-direction: column;
            border: var(--u) solid var(--main-accent);
            width: calc(var(--u)*104);
            flex-shrink: 0;
            gap: calc(var(--u)*10);
        }
        
        .score_container {
            container-type: inline-size;
            display: flex;
        }

        .score_row {
            display: flex;
        }

        .score_column {
            display: flex;
            flex-direction: column;
        }



        .player_header {
            color: var(--main-accent);
            font-size: calc(var(--u) * 20);
            text-align: center;
            height: calc(var(--u) * 30);
            width: calc(var(--u) * 104);
            border: var(--u) solid var(--main-accent);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .score_footer {
            color: var(--main-accent);
            font-size: calc(var(--u) * 20);
            text-align: center;
            height: calc(var(--u) * 30);
            width: calc(var(--u) * 104);
            border: var(--u) solid var(--main-accent);
            flex-shrink: 0;
        }

        
        
        .bid_box,
        .take_box {
            width: calc(var(--u) * 24);
            aspect-ratio: 1 / 1;
            border: var(--u) solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: calc(var(--u) * 15);
            background: var(--primary);
        }

        .bonus_box {
            width: calc(var(--u) * 66);
            height: calc(var(--u) * 20);
            border: var(--u) solid black;
            text-align: center;
            font-size: calc(var(--u) * 12);
            background: var(--primary);
        }

        .value_box {
            width: calc(var(--u) * (68 - 5*2));
            height: calc(var(--u) * (45 - 10));
            margin: calc(var(--u) * 5);
            border: var(--u) solid black;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: calc(var(--u) * 20);
            background: var(--secondary);
        }
        
        .arrow_btn {
            width: calc(var(--u) * 12);
            aspect-ratio: 1 / 1;
            border: var(--u) solid black;
            background: var(--tertiary);
            cursor: pointer;
            display: grid;
            place-items: center;
            color: white;
        }

        .toggle-btn {
            width: calc(var(--u) * 18);
            aspect-ratio: 3/2;
            border: var(--u) solid black;
            background: var(--tertiary);
            cursor: pointer;
            display: grid;
            place-items: center;
            color: var(--tertiary-accent);
        }

        .arrow_btn:hover,
        .toggle-btn:hover {
            background: var(--quaternary);
        }

        .arrow_btn:active {
            background: var(--quaternary-accent);
            color: var(--quaternary);
        }

        .toggle-btn.active {
            background: var(--tertiary-accent);
            color: var(--tertiary);
        }

        .toggle-btn.wager10 {
            background: var(--quaternary);
            color: var(--quaternary-accent);
        }

        .toggle-btn.wager20 {
            background: var(--tertiary-accent);
            color: var(--tertiary);
        }

        
        
        .material-symbols-outlined {
            font-size: calc(var(--u) * 8);
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 20;
        }

        .header-left-block {
            position: fixed;
            top: 60px;
            left: 0;
            width: calc(var(--u) * 35);
            height: calc(var(--u) * 30);
            background: var(--main);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .footer-left-block {
            position: fixed;
            bottom: 45px;
            left: 0;
            width: calc(var(--u) * 35);
            height: calc(var(--u) * 45);
            background: var(--main);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .floating-btn {
            position: fixed;
            top: 60px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--main-accent);
            color: var(--main);
            font-size: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: var(--u) solid var(--main);
        }

        .floating-btn:hover {
            transform: scale(1.1);
            background: var(--main-highlight);
        }

        .floating-btn:active {
            transform: scale(0.95);
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1002;
            align-items: center;
            justify-content: center;
        }

        .popup-overlay.active {
            display: flex;
        }

        .popup-content {
            background: var(--primary);
            padding: 30px;
            border-radius: 10px;
            border: 3px solid var(--main-accent);
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }

        .popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border: none;
            background: var(--tertiary);
            color: var(--tertiary-accent);
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-close:hover {
            background: var(--quaternary);
        }

        .popup-content h2 {
            color: var(--main);
            margin-bottom: 15px;
        }

        .popup-content h3 {
            color: var(--main);
            margin-top: 15px;
            margin-bottom: 5px;
        }

        .popup-content p {
            color: var(--main);
            line-height: 1.6;
            max-width: 500px;
        }
    </style>
</head>

<body>
    <div class="header-left-block">
        <button class="floating-btn" onclick="openPopup()">
            <span class="material-symbols-outlined">question_mark</span>
        </button>
    </div>

    <div class="popup-overlay" id="popupOverlay" onclick="closePopupOnOverlay(event)">
        <div class="popup-content">
            <button class="popup-close" onclick="closePopup()">Ã—</button>
            <h2>Skull King Scorecard</h2>
            <img src="assets/skullKingHelp.png" alt="Skull King Instructions" style="width:100%; height:auto; margin-bottom:15px;">
            <p>
                This scorecard is designed to help you keep track of scores while playing Skull King. 
                Above is a diagram showing how each part is to be used but a few pieces will require additional explination.
            </p>
            <h3>Round Column:</h3>
            <p>
                The round column on the far left keeps track of the current round but it also tracks the number of tricks that are already claimed. 
                In the event a kraken is played the number of claimed tricks will be 1 less then the round number.
            </p>
            <h3>Zero Bid:</h3>
            <p>
                The "Z" button is used to indicate that a player is attempting to bid zero tricks for that round. 
                Zero bids follow standard Skull King rules.
            </p>
            <h3>Wager:</h3>
            <p>
                The "W00" button is used to indicate that a player is placing a wager for that round. 
                The wager can be toggled between three states: 
                    no wager (W00), 
                    a 10-point wager (W10), 
                    and a 20-point wager (W20). 
                If the player meets their bid, they will earn the wagered points in addition to their score for that round. 
                If they fail to meet their bid, they will lose the wagered points in addition to their other negative points for the round.
            </p>
            <h3>Round Points:</h3>
            <p>
                The large box in each round will calculate the points for that round, but the total box at the bottom of the screen is the only place that the total points of all rounds is displayed.
                Additionally the scores are all calculated in real-time as bids, tricks, and bonuses are adjusted.
            </p>
        </div>
    </div>

    <div class="container">
        <div class="scrollable_wrapper">
            <div class="content_wrapper">
                <div class="header" id="header"></div>
                <div class="game_sheet" id="gameSheet"></div>
                <div class="footer" id="footer"></div>
            </div>
        </div>
    </div>

    <div class="footer-left-block"></div>

    <script>
        function createPlayerHeaders(playerNames) {
            let html = ``;
            for (let name of playerNames) {
                html += `
                    <div class="player_header player_${name.replace(/\s+/g, '_')}">${name}</div>
                `;
            }
            return html;
        }

        function createPlayerFooters(playerNames) {
            let html = ``;
            for (let name of playerNames) {
                html += `
                    <div class="score_footer player_${name.replace(/\s+/g, '_')}">
                        <span class="total_score">0</span>
                    </div>
                `;
            }
            return html;
        }

        function createRoundColumn(numRounds) {
            let roundLabels = '';
            for (let i = 1; i <= numRounds; i++) {
                roundLabels += `
                    <div class="round_label_container" data-round="${i}">0/${i}</div>
                `;
            }

            return `<div class="round_column" id="round_column">${roundLabels}</div>`;
        }

        function createScoreContainer(roundNum) {
            return `
                <div class="score_container" data-round="${roundNum}">
                    <div class="score_row">
                        <div class="score_column">
                            <div class="score_row">
                                <div class="bid_box">0</div>
                                <div class="score_column">
                                    <button class="arrow_btn" onclick="incrementValue(this, 'bid')"><span class="material-symbols-outlined">keyboard_arrow_up</span></button>
                                    <button class="arrow_btn" onclick="decrementValue(this, 'bid')"><span class="material-symbols-outlined">keyboard_arrow_down</span></button>
                                </div>
                            </div>
                            <div class="score_row">
                                <div class="take_box">0</div>
                                <div class="score_column">
                                    <button class="arrow_btn" onclick="incrementValue(this, 'take')"><span class="material-symbols-outlined">keyboard_arrow_up</span></button>
                                    <button class="arrow_btn" onclick="decrementValue(this, 'take')"><span class="material-symbols-outlined">keyboard_arrow_down</span></button>
                                </div>
                            </div>
                            <div class="score_row">
                                <button class="toggle-btn zero-bid" onclick="this.classList.toggle('active'); updateRoundScore(this);">Z</button>
                                <button class="toggle-btn wager" onclick="wager(this)">W00</button>
                            </div>
                        </div>
                        <div class="score_column">
                            <input type="number" class="bonus_box" value="0" oninput="updateRoundScore(this)">
                            <div class="value_box">0</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createPlayerColumn(playerName, numRounds) {
            let scoreContainers = '';
            for (let i = 1; i <= numRounds; i++) {
                scoreContainers += createScoreContainer(i);
            }

            return `
                <div class="player_column player_${playerName.replace(/\s+/g, '_')}">
                    ${scoreContainers}
                </div>
            `;
        }

        function generateGameSheet() {
            const urlParams = new URLSearchParams(window.location.search);
            const playersParam = urlParams.get('players');
            const players = playersParam 
                ? playersParam.split(',').map(p => p.trim())
                : ["Player 1", "Player 2", "Player 3"];
            
            const numRounds = 10;
            const header = document.getElementById('header');
            const footer = document.getElementById('footer');
            const gameSheet = document.getElementById('gameSheet');
            
            header.innerHTML = createPlayerHeaders(players);
            footer.innerHTML = createPlayerFooters(players);

            let html = createRoundColumn(numRounds);;
            for (let p of players) {
                html += createPlayerColumn(p, numRounds);
            }

            gameSheet.innerHTML = html;
        }

        function incrementValue(button, type) {
            const container = button.closest('.score_row');
            const box = container.querySelector(type === 'bid' ? '.bid_box' : '.take_box');
            let value = parseInt(box.textContent);
            value++;
            box.textContent = value;
            updateRoundScore(button);
            if (type === 'take') {
                updateRoundBids(button);
            }
        }

        function decrementValue(button, type) {
            const container = button.closest('.score_row');
            const box = container.querySelector(type === 'bid' ? '.bid_box' : '.take_box');
            let value = parseInt(box.textContent);
            if (value > 0) {
                value--;
                box.textContent = value;
                updateRoundScore(button);
                if (type === 'take') {
                    updateRoundBids(button);
                }
            }
        }

        function updateRoundBids(element) {
            const roundColumn = document.getElementById('round_column');
            const roundNum = parseInt(element.closest('.score_container').dataset.round);
            
            // Get all score containers for this round
            const scoreContainers = document.querySelectorAll(`.score_container[data-round="${roundNum}"]`);
            
            // Sum up all takes for this round
            let totalTakes = 0;
            scoreContainers.forEach(container => {
                const takeBox = container.querySelector('.take_box');
                totalTakes += parseInt(takeBox.textContent) || 0;
            });
            
            // Update the round label
            const roundLabel = roundColumn.querySelector(`.round_label_container[data-round="${roundNum}"]`);
            if (roundLabel) {
                roundLabel.textContent = `${totalTakes}/${roundNum}`;
            }
        }
        
        function wager(button) {
            if (button.classList.contains('wager10')) {
                button.classList.remove('wager10');
                button.classList.add('wager20');
                button.textContent = 'W20';
            } else if (button.classList.contains('wager20')) {
                button.classList.remove('wager20');
                button.textContent = 'W00';
            } else {
                button.classList.add('wager10');
                button.textContent = 'W10';
            }
            updateRoundScore(button);
        }

        function updateRoundScore(element) {
            const scoreContainer = element.closest('.score_container');
            const bidBox = scoreContainer.querySelector('.bid_box');
            const takeBox = scoreContainer.querySelector('.take_box');
            const bonusBox = scoreContainer.querySelector('.bonus_box');
            const valueBox = scoreContainer.querySelector('.value_box');
            const zeroButton = scoreContainer.querySelector('.zero-bid');
            const wagerButton = scoreContainer.querySelector('.wager');
            
            const bid = parseInt(bidBox.textContent);
            const take = parseInt(takeBox.textContent);
            const bonus = parseInt(bonusBox.value) || 0;
            const roundNum = parseInt(scoreContainer.dataset.round);
            
            let score = 0;
            if (bid === 0) {
                if (zeroButton.classList.contains('active')) {
                    if (take === 0) {
                        score = 10 * roundNum;
                    } else {
                        score = -10 * roundNum;
                    }
                }
            } else {
                if (bid === take) {
                    score = bid * 20;
                } else {
                    score = -10 * Math.abs(bid - take);
                }
            }

            if (bid === take) {
                score += bonus;
                if (wagerButton.classList.contains('wager10')) {
                    score += 10;
                } else if (wagerButton.classList.contains('wager20')) {
                    score += 20;
                }
            }
            else {
                if (wagerButton.classList.contains('wager10')) {
                    score -= 10;
                } else if (wagerButton.classList.contains('wager20')) {
                    score -= 20;
                }
            }
            
            valueBox.textContent = score;
            updateTotalScore(element);
        }

        function updateTotalScore(element) {
            const playerColumn = element.closest('.player_column');
            const valueBoxes = playerColumn.querySelectorAll('.value_box');
            
            // Find the player class (not player_column)
            const classes = playerColumn.className.split(' ');
            const playerClass = classes.find(c => c.startsWith('player_') && c !== 'player_column');

            const footer = document.getElementById('footer');
            const totalBox = footer.querySelector(`.${playerClass} .total_score`);
            
            let total = 0;
            valueBoxes.forEach(box => {
                total += parseInt(box.textContent) || 0;
            });
            
            totalBox.textContent = total;
        }

        function openPopup() {
            document.getElementById('popupOverlay').classList.add('active');
        }

        function closePopup() {
            document.getElementById('popupOverlay').classList.remove('active');
        }

        function closePopupOnOverlay(event) {
            if (event.target.id === 'popupOverlay') {
                closePopup();
            }
        }

        generateGameSheet();
    </script>
</body>

</html>
